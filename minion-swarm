#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
VENV_PY="${ROOT_DIR}/.venv/bin/python3"

if [[ ! -x "${VENV_PY}" ]]; then
  python3 -m venv "${ROOT_DIR}/.venv"
fi

if ! "${VENV_PY}" -m pip --version >/dev/null 2>&1; then
  "${VENV_PY}" -m ensurepip --upgrade >/dev/null 2>&1 || true
fi

if ! "${VENV_PY}" -c "import click, yaml, watchdog" >/dev/null 2>&1; then
  "${VENV_PY}" -m pip install -r "${ROOT_DIR}/requirements.txt"
fi

exec "${VENV_PY}" -m claude_swarm.cli "$@"
